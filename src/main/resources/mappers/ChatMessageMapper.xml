<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.DAO.ChatMessageRepository2">

	<resultMap id="ChatMessageMap" type="com.example.VO.ChatMessage">
	    <id     column="messageId"  property="messageId"/>
	    <result column="chatroomId" property="chatroomId"/>
	    <result column="senderId"   property="senderId"/>
	    <result column="content"    property="content"/>
	    <result column="timestamp"  property="timestamp"/>
	    <result column="isRead"     property="isRead"/>
	</resultMap>

	<insert id="insert" parameterType="com.example.VO.ChatMessage"
	        useGeneratedKeys="true" keyProperty="messageId">
	    INSERT INTO chat_message (chatroomId, senderId, content, timestamp, isRead)
	    VALUES (#{chatroomId}, #{senderId}, #{content}, NOW(), 0)
	</insert>

  <select id="findByRoomPaged" resultMap="ChatMessageMap">
    SELECT * FROM chat_message
    WHERE chatroom_id = #{roomId}
    <if test="beforeId != null">
      AND message_id &lt; #{beforeId}
    </if>
    ORDER BY message_id DESC
    LIMIT #{limit}
  </select>

</mapper>